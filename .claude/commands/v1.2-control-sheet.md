# v1.2 Control Sheet - Execution Plan

Use these tables as your execution plan. v1.1 is complete; v1.2 focuses on **UX polish, visual refinement, and completing the Property/Container hierarchy**.

For every row:
- Re-open and review all listed files for 100% completion (no TODOs, no drift)
- Make small, atomic commits (format: `feat|fix|chore(scope): description`)
- Use AskUserQuestion tool for uncertainty, especially pricing, roadmap changes, or orphaned code

---

## Table 0 - Session Meta-Rules

| # | Aspect | Rules | When to AskUserQuestion | Done Criteria |
|---|--------|-------|-------------------------|---------------|
| 0.1 | Ground truth | Treat TODO.md + PRODUCT-SPEC.md + CLAUDE.md as canonical. TODO-COMPLETE.md is history (v1.0 + v1.1 + partial v1.2). | If contradictions found between files, ask which wins. | Note which file was source of truth and why. |
| 0.2 | 100% completion | For every step, review every listed file ensuring change is complete. | When unsure if change needs follow-up in another file. | List: "For this step I touched: X, Y, Z. All now consistent." |
| 0.3 | Pricing & roadmap | May not directly change prices, tier names, or feature assignments without asking. | When adjusting pricing, tiers, or version targets. | Changes happen only after explicit approval. |
| 0.4 | Orphaned code | Never delete or re-home orphaned files silently. | When detecting unreferenced files. | Short "orphaned code" section noting findings and decisions. |
| 0.5 | Scope of autonomy | Free to implement Phase 12 UI polish. Don't invent v1.3+ features. | Any time tempted to implement beyond v1.2 scope. | v1.2 work grounded in existing tasks; no surprise features. |
| 0.6 | Commit discipline | One logical concern per commit. Descriptive messages. | If change sprawls across multiple areas, pause and ask how to split. | Short list of commits, each with clear purpose. |
| 0.7 | Design system first | Always implement/verify NestoryTheme tokens BEFORE using them in views. | When a view needs a token that doesn't exist yet. | Token exists in DesignSystem.swift before use. |

---

## Table 1 - Quick Sanity Pass (Verify v1.1 → v1.2 Transition)

| Step | Objective | Files to Check | Actions | When to Ask | Completion |
|------|-----------|----------------|---------|-------------|------------|
| 1.1 | Confirm v1.1 archived | TODO.md, TODO-COMPLETE.md | v1.1 section says "COMPLETE - Archived". TODO-COMPLETE.md has v1.1 tasks. | If v1.1 tasks missing from archive. | "v1.1 properly archived. 118 total completed tasks." |
| 1.2 | Validate P2-02 state | TODO.md (P2-02), Models/*, Views/Hierarchy/* | Confirm models exist, views created, 3 remaining subtasks: renaming, unit tests, integration tests. | If files missing or broken. | P2-02 files verified; 3 subtasks remain. |
| 1.3 | Verify Phase 12 structure | TODO.md (P2-06 to P2-19) | All 78 subtasks present with correct blocking dependencies. | If subtasks missing or dependencies wrong. | Phase 12 structure intact and ready. |
| 1.4 | Check XcodeGen project | project.yml, Nestory-Pro.xcodeproj | Run `xcodegen generate`, verify new v1.2 files included. | If build errors after regen. | Project builds clean with v1.2 files. |

---

## Table 2 - P2-02 Completion (Property/Container Hierarchy)

**STATUS:** 90% complete. 3 subtasks remain.

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 2.1 | Inline renaming support | Views/Hierarchy/*.swift | Add `.swipeActions` with "Rename" option OR inline TextField editing with long-press. | If unsure between inline vs. sheet approach. | Properties, Rooms, Containers can be renamed inline. |
| 2.2 | Unit tests for models | Nestory-ProTests/UnitTests/Models/ | Create PropertyTests.swift, ContainerTests.swift. Test validation, relationships, computed properties. | If test patterns unclear. | 80%+ coverage on new models. |
| 2.3 | Integration tests for migration | Nestory-ProTests/IntegrationTests/ | Create SchemaMigrationTests.swift. Test V1→V1_2 migration with sample data. Default property creation verified. | If migration test patterns needed. | Migration tested; no data loss confirmed. |
| 2.4 | Mark P2-02 complete | TODO.md | Update status to [x], move to completed section reference. | — | P2-02 fully complete, logged. |

---

## Table 3 - Track A: Design System Foundation (P2-06)

**CRITICAL:** This track MUST complete before any view work. All views depend on NestoryTheme.

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 3.1 | Create DesignSystem.swift | SharedUI/DesignSystem.swift | Implement `NestoryTheme` enum with all nested types: Colors, Metrics, Typography, Shadow, Animation, Haptics. | If design token values unclear. | DesignSystem.swift exists with all tokens. |
| 3.2 | Add color assets | Assets.xcassets | Add color sets: Background, CardBackground, Accent, Border, Muted, ChipBackground, Success, Warning, Error, Info. Light + dark variants. | If color values unclear. | All colors in asset catalog. |
| 3.3 | Test color contrast | DesignSystem tests | Add unit tests verifying WCAG AA contrast ratios (4.5:1 text, 3:1 UI). | — | Contrast tests passing. |
| 3.4 | Card modifiers | SharedUI/SharedComponents.swift | Implement `.cardStyle()`, `.loadingCard()`, `.errorCard()`, `.emptyStateCard()`, `.sectionHeader()`. | If modifier API unclear. | All modifiers exist with previews. |
| 3.5 | Layout scaffolding | SharedUI/SharedComponents.swift | Implement `StandardScrollLayout` wrapper. Document nav bar standards. | — | Layout patterns documented and usable. |
| 3.6 | Mark P2-06 complete | TODO.md | Update P2-06-1, P2-06-2, P2-06-3 as [x]. | — | Foundation complete, views unblocked. |

---

## Table 4 - Track B: ViewModel Presentation Models (P2-07)

**PURPOSE:** Enrich ViewModels with presentation-ready models. Keep views declarative.

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 4.1 | InventoryTabViewModel | ViewModels/InventoryTabViewModel.swift | Add `InventorySection`, `SearchMatchMetadata`, `ItemLimitWarningDisplay`. Implement `groupedSections`, `activeSearchMetadata`. | If grouping logic unclear. | VM has sections + metadata; unit tests pass. |
| 4.2 | CaptureTabViewModel | ViewModels/CaptureTabViewModel.swift | Add `CaptureMode`, `CaptureStatus`, `CaptureActionCard`. Replace booleans with enums. | If state machine unclear. | VM uses semantic states; unit tests pass. |
| 4.3 | AddItemViewModel | ViewModels/AddItemViewModel.swift | Add `AddItemField`, `AddItemSection`, `FieldValidationState`. Implement `formSections`, `validationState(for:)`. | If validation rules unclear. | Form driven by VM; validation works. |
| 4.4 | ReportsTabViewModel | ViewModels/ReportsTabViewModel.swift | Add `InventorySummary`, `ReportGenerationState`. Replace booleans with state enum. | — | State-driven report generation. |
| 4.5 | ItemDetailViewModel | ViewModels/ItemDetailViewModel.swift | Add `DocumentationStatus`, implement `locationText(for:)`, `warrantyStatusText(expiryDate:)`. | — | Rich display helpers; unit tests pass. |
| 4.6 | Mark P2-07 complete | TODO.md | Update P2-07-1 through P2-07-5 as [x]. | — | All VMs enriched. |

---

## Table 5 - Track C: New Hierarchy Views (P2-08)

**PURPOSE:** Apply polish to the new Property/Container/Room views FIRST (they're fresh).

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 5.1 | PropertyDetailView polish | Views/Hierarchy/PropertyDetailView.swift | Card-based sections, `.cardStyle()`, Summary/Rooms/Quick Actions cards, empty state. | If layout unclear. | Modern card layout with all states. |
| 5.2 | RoomDetailView polish | Views/Hierarchy/RoomDetailView.swift | Card sections, swipe actions, breadcrumbs, empty state. | — | Modern layout with interactions. |
| 5.3 | ContainerDetailView polish | Views/Hierarchy/ContainerDetailView.swift | Card sections, empty state, previews. | — | Consistent with other hierarchy views. |
| 5.4 | Mark P2-08 complete | TODO.md | Update P2-08-1, P2-08-2, P2-08-3 as [x]. | — | New views fully polished. |

---

## Table 6 - Track D: Retrofit Existing Views (P2-09 to P2-13)

**PURPOSE:** Apply design system to existing views. Order: App shell → Inventory → Item Detail → Capture → Forms → Settings/Reports.

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 6.1 | MainTabView + LockScreen | Views/MainTabView.swift, SharedUI/LockScreenView.swift | Tab appearance, lock blur, system-like lock design. (P2-09-1, P2-09-2) | — | Professional tab bar + lock screen. |
| 6.2 | InventoryTab retrofit | Views/Inventory/InventoryTab.swift | Card sections from VM, empty/loading/error states, item limit banner. (P2-09-3, P2-09-4) | If section rendering unclear. | State-driven inventory list. |
| 6.3 | ItemDetailView retrofit | Views/Inventory/ItemDetailView.swift | Hero photo header, info cards, documentation status card. (P2-10-1, P2-10-2, P2-10-3) | — | Rich, visually appealing detail view. |
| 6.4 | CaptureTab retrofit | Views/Capture/CaptureTab.swift, ReceiptCaptureView, PhotoCaptureView, BarcodeScanView | Action cards hub, status banner, camera view standardization. (P2-11-1 to P2-11-3) | If camera layout unclear. | Instructional, modern capture UX. |
| 6.5 | Add Item forms retrofit | Views/Inventory/AddItemView.swift, Capture/QuickAddItemSheet.swift | VM-driven form, validation states, keyboard toolbar. (P2-12-1, P2-12-2) | If form layout unclear. | Structured, validating forms. |
| 6.6 | Settings/Paywall/Reports retrofit | Views/Settings/SettingsTab.swift, Settings/ContextualPaywallSheet.swift, Reports/ReportsTab.swift | Card-based settings, marketing paywall, summary dashboard. (P2-13-1 to P2-13-4) | — | Professional settings + reports. |
| 6.7 | Mark P2-09 to P2-13 complete | TODO.md | Update all subtasks as [x]. | — | All existing views retrofitted. |

---

## Table 7 - Track E: Cross-Cutting Concerns (P2-14 to P2-17)

**PURPOSE:** Accessibility, animations, haptics, performance. Apply AFTER views are stable.

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 7.1 | Accessibility audit | All views | VoiceOver labels/hints, Dynamic Type, Reduce Motion, color contrast, identifiers. (P2-14-1 to P2-14-5) | If accessibility patterns unclear. | All views accessible; audit documented. |
| 7.2 | Animations | All views | View transitions, button press feedback, card expansion, loading skeleton. (P2-15-1 to P2-15-4) | If animation timing unclear. | Smooth animations with Reduce Motion support. |
| 7.3 | Haptics | All views | Success, error, selection feedback using NestoryTheme.Haptics. (P2-16-1 to P2-16-3) | — | Haptics trigger appropriately. |
| 7.4 | Performance | Services, Views | Image caching, lazy loading, progressive disclosure. (P2-17-1 to P2-17-3) | If caching strategy unclear. | 100+ items scroll smoothly. |
| 7.5 | Mark P2-14 to P2-17 complete | TODO.md | Update all subtasks as [x]. | — | Cross-cutting concerns complete. |

---

## Table 8 - Track F: Testing & Integration (P2-18 to P2-19)

| Step | Objective | Files | Actions | When to Ask | Completion |
|------|-----------|-------|---------|-------------|------------|
| 8.1 | VM presentation model tests | Nestory-ProTests/UnitTests/ViewModels/ | Unit tests for InventorySection, SearchMatchMetadata, DocumentationStatus, AddItemField validation. 90%+ coverage. | If test patterns unclear. | Presentation models fully tested. |
| 8.2 | Preview examples | All view files | Add `#Preview` for every state: empty, single, multiple, loading, error. | — | Every view has comprehensive previews. |
| 8.3 | Snapshot tests | Nestory-ProTests/SnapshotTests/ | Record baselines for all main views. Light + dark mode. 9.3.1-9.3.4 + new Phase 12 views. | If snapshot config unclear. | Baselines recorded; CI verifies. |
| 8.4 | Accessibility audit testing | On-device | VoiceOver navigation, Dynamic Type xxxLarge, Reduce Motion. | — | Accessibility verified on device. |
| 8.5 | Project integration | project.yml, Xcode | All new files in targets, assets in catalog, build all schemes. | If build errors. | Clean builds on Debug/Beta/Release. |
| 8.6 | Mark P2-18, P2-19 complete | TODO.md | Update all subtasks as [x]. | — | Testing complete. |

---

## Table 9 - Verification & Release

| Step | Objective | Files/Tools | Actions | When to Ask | Completion |
|------|-----------|-------------|---------|-------------|------------|
| 9.1 | Run full test suite | fastlane test | Run unit + UI tests. Fix failures. | If failures flaky or pre-existing. | All tests passing. |
| 9.2 | Documentation sync | README.md, PRODUCT-SPEC.md, TODO.md, CLAUDE.md | Update docs where behavior changed. v1.2 release checklist items verified. | If marketing language changes wanted. | Docs accurate for v1.2. |
| 9.3 | v1.2 release checklist | TODO.md | Verify: Onboarding ✓, Tags ✓, Feedback ✓, Reminders ✓, Hierarchy complete, Phase 12 complete. | — | All checklist items green. |
| 9.4 | Tag + handoff note | git, TODO.md | Propose tag (e.g., `v1.2-ux-polish`). Add Changelog entry. | Confirm tag name. | Tag created; summary ready. |

---

## Table 10 - Orphaned Code Protocol (Standing Rule)

| Rule | Scenario | Required Behavior | AskUserQuestion Usage | Outcome |
|------|----------|-------------------|----------------------|---------|
| OC-1 | View not referenced | Do not delete. Propose: integrate or archive. | Ask how to handle. | Integrated or parked with note. |
| OC-2 | Tests don't match behavior | Investigate. Suggest update or deprecation. | Ask if tests represent expected behavior. | Tests aligned or deprecated. |
| OC-3 | Duplicate helpers | Propose consolidation. | Show before/after sketch. | Single helper; references updated. |
| OC-4 | v1.1 code still referenced | Keep. Note in handoff if v1.2 supersedes. | Ask if safe to remove v1.1 references. | Clean boundaries between versions. |

---

## Current Session Progress

### v1.2 Scope Summary

| Category | Items | Status |
|----------|-------|--------|
| **P2-02 (Hierarchy)** | 3 remaining subtasks | In Progress |
| **P2-06 (Design System)** | 3 tasks, ~15 subtasks | Pending |
| **P2-07 (VM Models)** | 5 tasks, ~20 subtasks | Pending |
| **P2-08 (New Views)** | 3 tasks, ~12 subtasks | Pending |
| **P2-09-13 (Retrofit)** | 12 tasks, ~25 subtasks | Pending |
| **P2-14-17 (Cross-cut)** | 12 tasks, ~20 subtasks | Pending |
| **P2-18-19 (Testing)** | 6 tasks, ~12 subtasks | Pending |
| **9.3.1-9.3.4 (Snapshots)** | 4 deferred tests | Blocked on P2-02 |
| **TOTAL** | ~78 subtasks | Ready to begin |

### Recommended Execution Order

1. **Complete P2-02** (2.1-2.4) - Unblock Phase 12
2. **Foundation** (Tables 3-4) - Design system + VM models
3. **New Views** (Table 5) - Polish fresh hierarchy views
4. **Retrofit** (Table 6) - Apply polish to existing views
5. **Cross-cutting** (Table 7) - Accessibility, animations, haptics, performance
6. **Testing** (Table 8) - Comprehensive test coverage
7. **Release** (Table 9) - Verification and tagging

### Blocking Dependencies

```
P2-02 ──┬──> P2-06-1 (Design System)
        │
        └──> 9.3.1-9.3.4 (Snapshot tests)

P2-06-1 ──┬──> P2-06-2 (Card modifiers)
          │
          ├──> P2-06-3 (Layout scaffolding)
          │
          └──> P2-07-* (All VM models)

P2-06-2 ──┬──> P2-08-* (New hierarchy views)
          │
          └──> P2-09-* through P2-17-* (All view + cross-cutting work)

P2-07-* ──> P2-08-* through P2-13-* (Views need VM models)

All views ──> P2-14-* (Accessibility)
          ──> P2-15-* (Animations)
          ──> P2-16-* (Haptics)
          ──> P2-18-* (Testing)
          ──> P2-19-* (Integration)
```

### Files Already Created (v1.2 Work-in-Progress)

**Models:**
- `Nestory-Pro/Models/Property.swift` (166 lines)
- `Nestory-Pro/Models/Container.swift` (172 lines)
- `Nestory-Pro/Models/Tag.swift` (148 lines)
- `Nestory-Pro/Models/NestorySchema.swift` (V1_2 migration)

**Views:**
- `Nestory-Pro/Views/Hierarchy/BreadcrumbView.swift` (209 lines)
- `Nestory-Pro/Views/Hierarchy/PropertyListView.swift` (193 lines)
- `Nestory-Pro/Views/Hierarchy/PropertyDetailView.swift` (285 lines)
- `Nestory-Pro/Views/Hierarchy/RoomDetailView.swift` (323 lines)
- `Nestory-Pro/Views/Hierarchy/ContainerDetailView.swift` (291 lines)
- `Nestory-Pro/Views/Hierarchy/PropertyEditorSheet.swift` (214 lines)
- `Nestory-Pro/Views/Hierarchy/RoomEditorSheet.swift` (181 lines)
- `Nestory-Pro/Views/Hierarchy/ContainerEditorSheet.swift` (206 lines)
- `Nestory-Pro/Views/Onboarding/OnboardingView.swift` (404 lines)
- `Nestory-Pro/Views/Tags/TagPillView.swift` (372 lines)
- `Nestory-Pro/Views/Reminders/RemindersView.swift` (421 lines)

**Services:**
- `Nestory-Pro/Services/ReminderService.swift` (238 lines)
- `Nestory-Pro/Services/FeedbackService.swift` (234 lines)

**To Be Created:**
- `Nestory-Pro/Views/SharedUI/DesignSystem.swift` (NestoryTheme)
- Updated `SharedUI/SharedComponents.swift` (card modifiers)
- Updated ViewModels with presentation models
- Test files for new models and VMs

---

## Design System Reference (P2-06-1)

When implementing, follow this structure:

```swift
// SharedUI/DesignSystem.swift
enum NestoryTheme {
    enum Colors {
        static let background = Color("Background")
        static let cardBackground = Color("CardBackground")
        static let accent = Color.accentColor
        static let border = Color("Border")
        static let muted = Color("Muted")
        static let chipBackground = Color("ChipBackground")
        static let success = Color("Success")
        static let warning = Color("Warning")
        static let error = Color("Error")
        static let info = Color("Info")
    }

    enum Metrics {
        static let cornerRadiusSmall: CGFloat = 8
        static let cornerRadiusMedium: CGFloat = 12
        static let cornerRadiusLarge: CGFloat = 16
        static let paddingSmall: CGFloat = 8
        static let paddingMedium: CGFloat = 16
        static let paddingLarge: CGFloat = 24
        static let iconSizeSmall: CGFloat = 20
        static let iconSizeMedium: CGFloat = 28
        static let iconSizeLarge: CGFloat = 44
    }

    enum Typography {
        static let sectionTitle = Font.headline
        static let cardTitle = Font.subheadline.weight(.semibold)
        static let label = Font.subheadline
        static let value = Font.body.weight(.medium)
        static let caption = Font.caption
        static let footnote = Font.footnote
    }

    struct Shadow {
        static let card = (color: Color.black.opacity(0.08), radius: 8, x: 0, y: 2)
        static let elevated = (color: Color.black.opacity(0.12), radius: 16, x: 0, y: 4)
    }

    enum Animation {
        static let quick: Double = 0.2
        static let standard: Double = 0.35
        static let slow: Double = 0.5
        static let easeOut = SwiftUI.Animation.easeOut(duration: standard)
        static let spring = SwiftUI.Animation.spring(response: 0.35, dampingFraction: 0.7)
    }

    enum Haptics {
        enum Pattern { case success, error, warning, selection, impact }

        static func trigger(_ pattern: Pattern) {
            switch pattern {
            case .success: UINotificationFeedbackGenerator().notificationOccurred(.success)
            case .error: UINotificationFeedbackGenerator().notificationOccurred(.error)
            case .warning: UINotificationFeedbackGenerator().notificationOccurred(.warning)
            case .selection: UISelectionFeedbackGenerator().selectionChanged()
            case .impact: UIImpactFeedbackGenerator(style: .light).impactOccurred()
            }
        }
    }
}
```

---

*Generated: 2025-11-30 | Session: v1.2 Control Sheet Preparation*
*Target: Q1 2026 | Tasks: ~78 subtasks across P2-02 through P2-19*
