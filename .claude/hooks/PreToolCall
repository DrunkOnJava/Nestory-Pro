#!/usr/bin/env python3
"""
Block local xcodebuild commands - use Xcode Cloud instead.
Exit codes:
  0 = allow
  1 = ask user for approval
  2 = block completely
"""
import json
import sys

data = json.load(sys.stdin)
tool_name = data.get("tool_name", "")
tool_input = data.get("tool_input", {})

if tool_name == "Bash":
    command = tool_input.get("command", "")

    # Block xcodebuild test/build commands (require approval)
    if "xcodebuild" in command and any(x in command for x in ["test", "build", "-scheme"]):
        print("WARNING: Prefer Xcode Cloud instead of local xcodebuild.", file=sys.stderr)
        print("", file=sys.stderr)
        print("Xcode Cloud options:", file=sys.stderr)
        print("  /xcode-cloud-trigger-build  - Trigger a build", file=sys.stderr)
        print("  /xcode-cloud-list-builds    - List recent builds", file=sys.stderr)
        print("  /xcode-cloud-monitor-build  - Monitor build status", file=sys.stderr)
        print("", file=sys.stderr)
        print("Approve to run locally anyway, or cancel to use Xcode Cloud.", file=sys.stderr)
        sys.exit(1)  # Ask for user approval

sys.exit(0)
